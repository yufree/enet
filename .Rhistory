library(pnd)
library(pmd)
data("spmeinvivo")
cor(t(spmeinvivo$data))
meta <- spmeinvivo$data
metacor <- cor(t(meta))
metacor[abs(metacor)<cutoff] <- 0
df <- data.frame(from=rownames(meta)[which(lower.tri(metacor), arr.ind = T)[, 1]],to=rownames(meta)[which(lower.tri(metacor), arr.ind = T)[, 2]],cor=metacor[lower.tri(metacor)])
df <- df[abs(df$cor)>0,]
net <- igraph::graph_from_data_frame(df,directed = F)
netc <- igraph::components(net)
cutoff=0.8
metacor <- cor(t(meta))
metacor[abs(metacor)<cutoff] <- 0
df <- data.frame(from=rownames(meta)[which(lower.tri(metacor), arr.ind = T)[, 1]],to=rownames(meta)[which(lower.tri(metacor), arr.ind = T)[, 2]],cor=metacor[lower.tri(metacor)])
df <- df[abs(df$cor)>0,]
net <- igraph::graph_from_data_frame(df,directed = F)
netc <- igraph::components(net)
plot(ne)
plot(net)
x <- globalstd(spmeinvivo)
meta <- x$data[x$stdmassindex,]
metacor <- cor(t(meta))
metacor[abs(metacor)<cutoff] <- 0
df <- data.frame(from=rownames(meta)[which(lower.tri(metacor), arr.ind = T)[, 1]],to=rownames(meta)[which(lower.tri(metacor), arr.ind = T)[, 2]],cor=metacor[lower.tri(metacor)])
df <- df[abs(df$cor)>0,]
net <- igraph::graph_from_data_frame(df,directed = F)
netc <- igraph::components(net)
plot(net)
cutoff=0.9
metacor <- cor(t(meta))
metacor[abs(metacor)<cutoff] <- 0
df <- data.frame(from=rownames(meta)[which(lower.tri(metacor), arr.ind = T)[, 1]],to=rownames(meta)[which(lower.tri(metacor), arr.ind = T)[, 2]],cor=metacor[lower.tri(metacor)])
df <- df[abs(df$cor)>0,]
net <- igraph::graph_from_data_frame(df,directed = F)
netc <- igraph::components(net)
plot(net)
plot(net,vertex.label=NA)
plot(net,vertex.label=NA,vertex.size=1)
x <- globalstd(spmeinvivo,corcutoff = 0.9)
meta <- x$data[x$stdmassindex,]
metacor <- cor(t(meta))
metacor[abs(metacor)<cutoff] <- 0
df <- data.frame(from=rownames(meta)[which(lower.tri(metacor), arr.ind = T)[, 1]],to=rownames(meta)[which(lower.tri(metacor), arr.ind = T)[, 2]],cor=metacor[lower.tri(metacor)])
df <- df[abs(df$cor)>0,]
net <- igraph::graph_from_data_frame(df,directed = F)
netc <- igraph::components(net)
plot(net,vertex.label=NA,vertex.size=1)
cutoff=0.95
metacor <- cor(t(meta))
metacor[abs(metacor)<cutoff] <- 0
df <- data.frame(from=rownames(meta)[which(lower.tri(metacor), arr.ind = T)[, 1]],to=rownames(meta)[which(lower.tri(metacor), arr.ind = T)[, 2]],cor=metacor[lower.tri(metacor)])
df <- df[abs(df$cor)>0,]
net <- igraph::graph_from_data_frame(df,directed = F)
netc <- igraph::components(net)
plot(net,vertex.label=NA,vertex.size=1)
netc$no
netc$membership
V(net)$names
igraph::V(net)$names[netc$membership == i]
igraph::V(net)$names
igraph::V(net)$name
unique(c(df$from,df$to))
unique(c(as.character(df$from),as.character(df$to)))
V(net)
igraph::V(net)
netc$csize
c <- c()
c[c(1,56,90)] <- 100
c
match(rownames(meta),mcni)
mcni <- igraph::V(net)$name[netc$membership == 1]
match(rownames(meta),mcni)
match(mcni,rownames(meta))
metai <- meta[match(mcni,rownames(meta)),]
cor(mcni)
cor(metai)
cor(t(metai))
View(metai)
c('A','B') %in% c('c','d','A')
source('~/Documents/rpkg/exponet/R/enet.R')
z <- getmmnet()
z <- getmmnet(meta)
source('~/Documents/rpkg/exponet/R/enet.R')
z <- getmmnet(meta)
z <- getmmnet(meta,cutoff = 0.96)
n(net)
library(igraph)
sizes(net)
?V(net)
print(net)
source('~/Documents/rpkg/exponet/R/enet.R')
rownames(netc$membership)
names(netc$membership)
match(names(netc$membership),rownames(meta))
match(,rownames(meta),names(netc$membership))
match(rownames(meta),names(netc$membership))
rownames(meta)[match(names(netc$membership),rownames(meta))]
rownames(meta)[match(rownames(meta),names(netc$membership))]
match(c(1:10),c(9:102))
match(c(9:102),c(1:10),)
match(rownames(meta),names(netc$membership))
netc$membership[match(rownames(meta),names(netc$membership))]
c(1:10)[match(c(9:102),c(1:10),)]
c(9:102)[match(c(9:102),c(1:10),)]
c(3:10)[match(c(9:102),c(3:10),)]
rownames(meta)[match(names(netc$membership),rownames(meta))]
head(names(netc$membership))
rep(NA,length(rownames(meta)))
index[match(names(netc$membership),rownames(meta))] <- netc$membership
index <- rep(NA,length(rownames(meta)))
index[match(names(netc$membership),rownames(meta))] <- netc$membership
source('~/Documents/rpkg/exponet/R/enet.R')
z <- getmmnet(meta)
z <- getmmnet(meta,cutoff = 0.9)
z$``
source('~/Documents/rpkg/exponet/R/enet.R')
z <- getmmnet(meta,cutoff = 0.9)
z$index
z$data[[1]]
table(z$index)
z$data[[2]]
sum(is.na(index))
source('~/Documents/rpkg/exponet/R/enet.R')
z <- getmmnet(meta,cutoff = 0.9)
z$net
z <- getmmnet(meta,cutoff = 0.8)
z <- getmmnet(meta,cutoff = 0.6)
geteenet
nacf <- 0.2
apply(meta,1,function(x)sum(is.na(x))/length(x)<nacf)
source('~/Documents/rpkg/exponet/R/enet.R')
c <- geteenet(meta)
source('~/Documents/rpkg/exponet/R/enet.R')
expo <- readRDS("~/Documents/rpkg/exponet/expo.RDS")
meta <- readRDS("~/Documents/rpkg/exponet/meta.RDS")
m <- getmmnet(meta)
e <- geteenet(expo)
source('~/Documents/rpkg/exponet/R/enet.R')
e <- geteenet(expo)
source('~/Documents/rpkg/exponet/R/enet.R')
e <- geteenet(expo)
row <- apply(expo,1,function(x)sum(is.na(x))/length(x)>nacf)
expo2 <- expo[row,]
expo3 <- impute::impute.knn(expo2)$data
expcor <- cor(t(expo3))
row
row <- apply(expo,1,function(x)sum(is.na(x))/length(x)<nacf)
expo2 <- expo[row,]
expo3 <- impute::impute.knn(expo2)$data
expcor <- cor(t(expo3))
e <- geteenet(expo)
expcor[abs(expcor)<cutoff] <- 0
df <- data.frame(from=rownames(expo3)[which(lower.tri(expcor), arr.ind = T)[, 1]],to=rownames(expo3)[which(lower.tri(expcor), arr.ind = T)[, 2]],cor=expcor[lower.tri(expcor)])
df <- df[df$cor>0,]
geteenet <- function(expo,cutoff=0.6,nacf=0.2){
row <- apply(expo,1,function(x)sum(is.na(x))/length(x)<nacf)
expo2 <- expo[row,]
expo3 <- impute::impute.knn(expo2)$data
expcor <- cor(t(expo3))
expcor[abs(expcor)<cutoff] <- 0
df <- data.frame(from=rownames(expo3)[which(lower.tri(expcor), arr.ind = T)[, 1]],to=rownames(expo3)[which(lower.tri(expcor), arr.ind = T)[, 2]],cor=expcor[lower.tri(expcor)])
df <- df[df$cor>0,]
df$direction <- ifelse(df$cor>0,'positive','negative')
message(paste(nrow(expo3), 'exposures have correlation with other exposures'))
return(df)
}
e <- geteenet(expo)
source('~/Documents/rpkg/exponet/R/enet.R')
e <- geteenet(expo)
View(e)
nrow(df)
source('~/Documents/rpkg/exponet/R/enet.R')
s <- getemnet(meta,expo)
expo <- readRDS("~/Documents/rpkg/exponet/expo.RDS")
meta <- readRDS("~/Documents/rpkg/exponet/meta.RDS")
df <- getmmnet(meta)$net
dfe <- geteenet(expo,cutoff=0.6,nacf=0.2)
source('~/Documents/rpkg/exponet/R/enet.R')
colindex <- match(colnames(expo),colnames(meta))
colindex2 <- match(colnames(meta),colnames(expo))
meta <- meta[,colindex[!is.na(colindex)]]
expo <- expo[,colindex2[!is.na(colindex2)]]
df <- getmmnet(meta,cutoff = cutoffm)$net
dfe <- geteenet(expo,cutoff = cutoffe,nacf=nacf)
ex <- ic <- dt <- c()
for(i in 1:nrow(expo)){
fit1 <- limma::lmFit(log2(meta+1), model.matrix(~expo[i,]))
fit2  <- limma::eBayes(fit1)
idx <- limma::topTable(fit2,coef=2,adjust.method = "BH",sort.by = 'none',number = nrow(fit2))
ic <- c(ic,rownames(meta)[idx$adj.P.Val<0.05])
ex <- c(ex,rep(rownames(expo)[i],sum(idx$adj.P.Val<0.05)))
dt <- c(dt,ifelse(idx$t[idx$adj.P.Val<0.05]>0,'positive','negative'))
}
dfme <- cbind.data.frame(from=ic,to=ex,cor=1,direction=dt)
tab <- table(dfme$from,dfme$to)
li <- apply(tab,1,sum)
tab
li
View(dfe)
dfe$from
source('~/Documents/rpkg/exponet/R/enet.R')
geteenet <- function(expo,cutoff=0.6,nacf=0.2){
row <- apply(expo,1,function(x)sum(is.na(x))/length(x)<nacf)
expo2 <- expo[row,]
expo3 <- impute::impute.knn(expo2)$data
expcor <- cor(t(expo3))
expcor[abs(expcor)<cutoff] <- 0
df <- data.frame(from=rownames(expo3)[which(lower.tri(expcor), arr.ind = T)[, 1]],to=rownames(expo3)[which(lower.tri(expcor), arr.ind = T)[, 2]],cor=expcor[lower.tri(expcor)])
df <- df[df$cor>0,]
if(nrow(df)>0){
df$direction <- ifelse(df$cor>0,'positive','negative')
net <- igraph::graph_from_data_frame(df,directed = F)
netc <- igraph::components(net)
message(paste(netc$no, 'exposures have correlation with other exposures.'))
index <- rep(NA,length(rownames(expo3)))
index[match(names(netc$membership),rownames(expo3))] <- netc$membership
message(paste(sum(is.na(index)), 'exposures have no correlation with other exposures'))
re <- list()
if(is.null(m)){
for (i in 1:netc$no){
mcni <- igraph::V(net)$name[netc$membership == i]
expoi <- expo[match(mcni,rownames(expo)),]
re[[i]] <- expoi
}
}else{
n <- unique(netc$membership[igraph::V(net)$name %in% m])
for(i in 1:length(n)){
mcni <- igraph::V(net)$name[netc$membership == n[i]]
expoi <- expo[match(mcni,rownames(expo)),]
re[[i]] <- expoi
}
return(list(index=index,data=re,net=df))
}else{
message('exposures have no correlation with each others.')
return(NULL)
}
ee <- geteenet(expo)
source('~/Documents/rpkg/exponet/R/enet.R')
ee <- geteenet(expo)
unique(as.character(dfe$to,dfe$from))
cutoffm=0.9;cutoffe=0.6;nacf=0.2
colindex <- match(colnames(expo),colnames(meta))
colindex2 <- match(colnames(meta),colnames(expo))
meta <- meta[,colindex[!is.na(colindex)]]
expo <- expo[,colindex2[!is.na(colindex2)]]
m <- getmmnet(meta,cutoff = cutoffm)
e <- geteenet(expo,cutoff = cutoffe,nacf=nacf)
df <- m$net
dfe <- e$net
ex <- ic <- dt <- c()
for(i in 1:nrow(expo)){
fit1 <- limma::lmFit(log2(meta+1), model.matrix(~expo[i,]))
fit2  <- limma::eBayes(fit1)
idx <- limma::topTable(fit2,coef=2,adjust.method = "BH",sort.by = 'none',number = nrow(fit2))
ic <- c(ic,rownames(meta)[idx$adj.P.Val<0.05])
ex <- c(ex,rep(rownames(expo)[i],sum(idx$adj.P.Val<0.05)))
dt <- c(dt,ifelse(idx$t[idx$adj.P.Val<0.05]>0,'positive','negative'))
}
dfme <- cbind.data.frame(from=ic,to=ex,cor=1,direction=dt)
tab <- table(dfme$from,dfme$to)
li <- apply(tab,1,sum)
message(paste(length(li[li>1]),'peaks with multiple exposures associated'))
for(i in unique(li)){
message(paste(length(li[li==i]),'peaks with', i ,'exposures associated'))
}
# li <- li[li>2]
net <- igraph::graph_from_data_frame(df,directed = F)
netc <- igraph::components(net)
lire <- list()
for (i in 1:length(li)){
dfei <- dfe[dfe$from %in% names(li[i]),]
if(sum(names(netc$membership) %in% names(li[i]))!=0){
c <- names(netc$membership[netc$membership == netc$membership[names(netc$membership) %in% names(li[i])]])
dfi <- df[df$from %in% c|df$to %in% c,]
re <- rbind.data.frame(dfi,dfei)
}else{
dfei$m <- 'none'
re <- dfei
}
lire[[i]] <- re
}
message(paste(sum(sapply(lire, dim)[2,]==4),'peaks connected with other peaks and exposures'))
message(paste(sum(sapply(lire, dim)[2,]==5),'peaks connected with exposures only'))
lire <- list()
for (i in 1:length(li)){
dfei <- dfe[dfe$from %in% names(li[i]),]
if(sum(names(netc$membership) %in% names(li[i]))!=0){
c <- names(netc$membership[netc$membership == netc$membership[names(netc$membership) %in% names(li[i])]])
dfi <- df[df$from %in% c|df$to %in% c,]
re <- rbind.data.frame(dfi,dfei)
}else{
dfei$m <- 'none'
re <- dfei
}
lire[[i]] <- re
}
source('~/Documents/rpkg/exponet/R/enet.R')
dfme <- cbind.data.frame(from=ic,to=ex,cor=1,direction=dt)
# for individual exposure
tab <- table(dfme$from,dfme$to)
li <- apply(tab,1,sum)
message(paste(length(li[li>1]),'peaks with multiple exposures associated'))
for(i in unique(li)){
message(paste(length(li[li==i]),'peaks with', i ,'exposures associated'))
}
# li <- li[li>2]
net <- igraph::graph_from_data_frame(df,directed = F)
netc <- igraph::components(net)
lire <- list()
for (i in 1:length(li)){
dfmei <- dfme[dfme$from %in% names(li[i]),]
if(sum(names(netc$membership) %in% names(li[i]))!=0){
c <- names(netc$membership[netc$membership == netc$membership[names(netc$membership) %in% names(li[i])]])
dfi <- df[df$from %in% c|df$to %in% c,]
re <- rbind.data.frame(dfi,dfmei)
}else{
dfmei$m <- 'none'
re <- dfmei
}
lire[[i]] <- re
}
message(paste(sum(sapply(lire, dim)[2,]==4),'peaks connected with other peaks and exposures'))
message(paste(sum(sapply(lire, dim)[2,]==5),'peaks connected with exposures only'))
names(netc$membership)
names(li[i])
names(netc$membership) %in% names(li)
table(names(netc$membership) %in% names(li))
m <- getmmnet(meta,cutoff = 0.8)
e <- geteenet(expo,cutoff = cutoffe,nacf=nacf)
df <- m$net
dfe <- e$net
ex <- ic <- dt <- c()
for(i in 1:nrow(expo)){
fit1 <- limma::lmFit(log2(meta+1), model.matrix(~expo[i,]))
fit2  <- limma::eBayes(fit1)
idx <- limma::topTable(fit2,coef=2,adjust.method = "BH",sort.by = 'none',number = nrow(fit2))
ic <- c(ic,rownames(meta)[idx$adj.P.Val<0.05])
ex <- c(ex,rep(rownames(expo)[i],sum(idx$adj.P.Val<0.05)))
dt <- c(dt,ifelse(idx$t[idx$adj.P.Val<0.05]>0,'positive','negative'))
}
dfme <- cbind.data.frame(from=ic,to=ex,cor=1,direction=dt)
# for individual exposure
tab <- table(dfme$from,dfme$to)
li <- apply(tab,1,sum)
message(paste(length(li[li>1]),'peaks with multiple exposures associated'))
for(i in unique(li)){
message(paste(length(li[li==i]),'peaks with', i ,'exposures associated'))
}
# li <- li[li>2]
net <- igraph::graph_from_data_frame(df,directed = F)
netc <- igraph::components(net)
lire <- list()
for (i in 1:length(li)){
dfmei <- dfme[dfme$from %in% names(li[i]),]
if(sum(names(netc$membership) %in% names(li[i]))!=0){
c <- names(netc$membership[netc$membership == netc$membership[names(netc$membership) %in% names(li[i])]])
dfi <- df[df$from %in% c|df$to %in% c,]
re <- rbind.data.frame(dfi,dfmei)
}else{
dfmei$m <- 'none'
re <- dfmei
}
lire[[i]] <- re
}
message(paste(sum(sapply(lire, dim)[2,]==4),'peaks connected with other peaks and exposures'))
message(paste(sum(sapply(lire, dim)[2,]==5),'peaks connected with exposures only'))
ec <- rownames(e)[e$index]
ec
e$index
rownames(expo)[e$index]
View(expo)
expo[!is.na(e$index)]
expo[!is.na(e$index),]
ec <- expo[!is.na(e$index),]
rownames(expo)[!is.na(e$index)]
index[!is.na(e$index)]
e$index[!is.na(e$index)]
ex
match(ec,ex)
ec <- rownames(expo)[!is.na(e$index)]
ecc <- e$index[!is.na(e$index)]
match(ec,ex)
ecc
table(ecc~ec)
table(ec~ecc)
ec
ecc
ec[4] <- 'BCD'
ecc=c(1,1,2,2)
ec
ecc
table(ec~ecc)
table(ecc~ec)
match(ex,ec)
head(ex)
merge(ex,cbind.data.frame(ec,ecc))
eci
ec
ec %in% dfe$to
ec %in% dfme$to
dfme$to %in% ec
dfmei <- dfme[dfme$to %in% ec,]
tab <- table(dfmei$from,dfmei$to)
tab
View(dfmei)
table(dfmei$to)
lii <- apply(tab,1,sum)
lii
mc <- rownames(meta)[!is.na(m$index)]
mcc <- m$index[!is.na(m$index)]
mcc
mc
mcc[mc %in% dfmei$from]
table(mcc[mc %in% dfmei$from])
mcc %in% unique(mcci)
mcci <- mcc[mc %in% dfmei$from]
mc %in% dfmei$from
unique(mcci)
mcc[mcc %in% unique(mcci)]
unique(mcc[mcc %in% unique(mcci)])
source('~/Documents/rpkg/exponet/R/enet.R')
em <- getemnet(meta,expo)
source('~/Documents/rpkg/exponet/R/enet.R')
em <- getemnet(meta,expo)
em$cluster
source('~/Documents/rpkg/exponet/R/enet.R')
usethis::use_data(expo)
usethis::use_data(meta)
data(meta)
mm <- getmmnet(meta)
source('~/Documents/rpkg/exponet/R/enet.R')
mm <- getmmnet(meta)
source('~/Documents/rpkg/exponet/R/enet.R')
mm <- getmmnet(meta)
source('~/Documents/rpkg/exponet/R/enet.R')
?cor
source('~/Documents/rpkg/exponet/R/enet.R')
mm <- getmmnet(meta,method='spearman')
source('~/Documents/rpkg/exponet/R/enet.R')
mm <- getmmnet(meta,method='spearman')
data(expo)
mm <- geteenet(expo)
source('~/Documents/rpkg/exponet/R/enet.R')
mm <- geteenet(expo)
source('~/Documents/rpkg/exponet/R/enet.R')
?`...`
man('...')
help('...')
source('~/Documents/rpkg/exponet/R/enet.R')
me <- getemnet(meta,expo)
source('~/Documents/rpkg/exponet/R/enet.R')
me <- getemnet(meta,expo)
me <- getemnet(meta,expo,method="spearman")
me$me
source('~/Documents/rpkg/exponet/R/enet.R')
roxygen2::roxygenise()
rm(list = c("geteenet", "getemnet", "getmmnet"))
roxygen2::roxygenise()
mm <- geteenet(expo,name='xx')
getwd()
!is.null('xx')
source('~/Documents/rpkg/exponet/R/enet.R')
mm <- geteenet(expo,name='xx')
source('~/Documents/rpkg/exponet/R/enet.R')
roxygen2::roxygenise()
rm(list = c("geteenet", "getemnet", "getmmnet"))
roxygen2::roxygenise()
library(enet)
usethis::use_readme_md()
usethis::use_vignette()
usethis::use_vignette('exposomics')
library(enet)
source('~/Documents/rpkg/enet/R/enet.R')
library(enet)
usethis::use_vignette()
usethis::use_vignette(name = 'network',title = 'network tutorial')
install.packages('IRkernel')
IRkernel::installspec()
